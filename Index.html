<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Putzplan Monatsansicht</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 30px;
    }
    .day {
      border: 1px solid #ccc;
      padding: 5px;
      min-height: 80px;
      cursor: pointer;
    }
    .day.active {
      background-color: #def;
    }
    .task {
      margin-bottom: 10px;
      padding: 5px;
      border: 1px solid #ccc;
      position: relative;
    }
    .sign-icon {
      position: absolute;
      right: 5px;
      top: 5px;
      cursor: pointer;
    }
    .signature-canvas {
      border: 1px solid #000;
      touch-action: none;
    }
    .signature-popup {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #666;
      padding: 10px;
      z-index: 1000;
    }
    .signature-popup button {
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Putzplan f√ºr <span id="currentMonthYear"></span></h1>
  <div class="calendar" id="calendar"></div>  <h2>Aufgaben f√ºr <span id="selectedDateDisplay"></span></h2>
  <div id="tasks">
    <h3>Fr√ºhdienst</h3>
    <div id="frueh" class="task-list"></div>
    <button onclick="addTask('frueh')">+ Aufgabe hinzuf√ºgen</button><h3>Tagdienst</h3>
<div id="tag" class="task-list"></div>
<button onclick="addTask('tag')">+ Aufgabe hinzuf√ºgen</button>

<h3>Sp√§tdienst</h3>
<div id="spaet" class="task-list"></div>
<button onclick="addTask('spaet')">+ Aufgabe hinzuf√ºgen</button>

  </div>  <div id="signaturePopup" class="signature-popup" style="display:none;">
    <canvas id="signatureCanvas" class="signature-canvas" width="300" height="150"></canvas><br>
    <button onclick="saveSignature()">Speichern</button>
    <button onclick="closeSignaturePopup()">Abbrechen</button>
  </div>  <script>
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0, lastY = 0;
    let currentTaskId = null;
    let selectedDate = null;

    function formatDateKey(date) {
      return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
    }

    function generateCalendar() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      document.getElementById('currentMonthYear').textContent = now.toLocaleString('de-DE', { month: 'long', year: 'numeric' });

      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      for (let i = 1; i <= daysInMonth; i++) {
        const div = document.createElement('div');
        div.className = 'day';
        div.textContent = i;
        div.onclick = () => selectDate(new Date(year, month, i));
        calendar.appendChild(div);
      }
    }

    function selectDate(date) {
      selectedDate = date;
      document.getElementById('selectedDateDisplay').textContent = date.toLocaleDateString('de-DE');
      document.querySelectorAll('.day').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.day')[date.getDate() - 1].classList.add('active');
      loadTasks();
    }

    function addTask(section) {
      if (!selectedDate) return alert('Bitte zuerst einen Tag ausw√§hlen.');

      const taskList = document.getElementById(section);
      const taskId = `${formatDateKey(selectedDate)}_${section}_${Date.now()}`;
      const taskDiv = document.createElement('div');
      taskDiv.className = 'task';
      taskDiv.id = taskId;
      taskDiv.innerHTML = `Neue Aufgabe
        <span class="sign-icon" title="Unterschreiben" onclick="openSignaturePopup('${taskId}')">üñäÔ∏è</span>
        <div class="signature-image" style="margin-top:5px;"></div>`;
      taskList.appendChild(taskDiv);
      saveTasks();
    }

    function saveTasks() {
      if (!selectedDate) return;
      const sections = ['frueh', 'tag', 'spaet'];
      const dayKey = formatDateKey(selectedDate);
      const data = {};
      sections.forEach(section => {
        const divs = document.querySelectorAll(`#${section} .task`);
        data[section] = Array.from(divs).map(div => div.id);
      });
      localStorage.setItem(`tasks_${dayKey}`, JSON.stringify(data));
    }

    function loadTasks() {
      const sections = ['frueh', 'tag', 'spaet'];
      const dayKey = formatDateKey(selectedDate);
      const data = JSON.parse(localStorage.getItem(`tasks_${dayKey}`)) || {};

      sections.forEach(section => {
        const list = document.getElementById(section);
        list.innerHTML = '';
        (data[section] || []).forEach(id => {
          const div = document.createElement('div');
          div.className = 'task';
          div.id = id;
          div.innerHTML = `Aufgabe
            <span class="sign-icon" title="Unterschreiben" onclick="openSignaturePopup('${id}')">üñäÔ∏è</span>
            <div class="signature-image" style="margin-top:5px;"></div>`;
          list.appendChild(div);
          loadSignature(id);
        });
      });
    }

    function openSignaturePopup(taskId) {
      currentTaskId = taskId;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('signaturePopup').style.display = 'block';
    }

    function closeSignaturePopup() {
      document.getElementById('signaturePopup').style.display = 'none';
      currentTaskId = null;
    }

    canvas.addEventListener('mousedown', e => {
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });
    canvas.addEventListener('mousemove', e => {
      if (!isDrawing) return;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.touches[0].clientX - rect.left;
      lastY = e.touches[0].clientY - rect.top;
    });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      [lastX, lastY] = [x, y];
    });
    canvas.addEventListener('touchend', () => isDrawing = false);

    function saveSignature() {
      if (!currentTaskId) return;
      const dataURL = canvas.toDataURL();
      localStorage.setItem(`signature_${currentTaskId}`, dataURL);
      loadSignature(currentTaskId);
      closeSignaturePopup();
    }

    function loadSignature(taskId) {
      const dataURL = localStorage.getItem(`signature_${taskId}`);
      if (dataURL) {
        const taskDiv = document.getElementById(taskId);
        if (taskDiv) {
          let imgDiv = taskDiv.querySelector('.signature-image');
          imgDiv.innerHTML = `<img src="${dataURL}" alt="Unterschrift" style="max-width:100%; max-height:80px; border:1px solid #ccc;">`;
        }
      }
    }

    // Initialisieren
    generateCalendar();
  </script></body>
</html>
