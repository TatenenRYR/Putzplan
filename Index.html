<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Putzplan</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0fff0;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .task-list {
      margin-bottom: 20px;
    }
    .task {
      margin-bottom: 10px;
      padding: 5px;
      border: 1px solid #ccc;
      position: relative;
      background-color: #e0ffe0;
    }
    .sign-icon {
      position: absolute;
      right: 5px;
      top: 5px;
      cursor: pointer;
    }
    .signature-canvas {
      border: 1px solid #000;
      touch-action: none;
    }
    .signature-popup {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #666;
      padding: 10px;
      z-index: 1000;
    }
    .signature-popup button {
      margin-top: 5px;
    }
    .admin-toggle {
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="navigation">
    <button onclick="prevDay()">‚óÄ</button>
    <div id="currentDate"></div>
    <button onclick="nextDay()">‚ñ∂</button>
  </div>  <div class="admin-toggle">
    <label>
      <input type="checkbox" id="adminModeToggle" onchange="toggleAdminMode()"> Administration aktivieren
    </label>
  </div>  <div id="planContainer"></div>  <div id="signaturePopup" class="signature-popup" style="display:none;">
    <canvas id="signatureCanvas" class="signature-canvas" width="300" height="150"></canvas>
    <br>
    <button onclick="saveSignature()">Speichern</button>
    <button onclick="closeSignaturePopup()">Abbrechen</button>
  </div>  <script>
    let currentDay = new Date().getDate();
    const today = new Date();
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let currentTaskId = null;
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    const dienstarten = ['frueh', 'tag', 'spaet'];

    function updateView() {
      const date = new Date(today.getFullYear(), today.getMonth(), currentDay);
      document.getElementById('currentDate').innerText = date.toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

      const planContainer = document.getElementById('planContainer');
      planContainer.innerHTML = '';

      dienstarten.forEach(dienst => {
        const title = document.createElement('h3');
        title.textContent = dienst.charAt(0).toUpperCase() + dienst.slice(1) + 'dienst';
        planContainer.appendChild(title);

        const taskList = document.createElement('div');
        taskList.id = `${dienst}-${currentDay}`;
        taskList.className = 'task-list';
        planContainer.appendChild(taskList);

        if (document.getElementById('adminModeToggle').checked) {
          const button = document.createElement('button');
          button.textContent = '+ Aufgabe hinzuf√ºgen';
          button.onclick = () => addTask(dienst);
          planContainer.appendChild(button);
        }

        loadTasks(dienst);
      });
    }

    function addTask(dienst) {
      const taskList = document.getElementById(`${dienst}-${currentDay}`);
      const taskId = `${dienst}-${currentDay}-${Date.now()}`;

      const taskDiv = document.createElement('div');
      taskDiv.className = 'task';
      taskDiv.id = taskId;
      taskDiv.innerHTML = `
        Aufgabe ${taskList.children.length + 1}
        <span class="sign-icon" title="Unterschreiben" onclick="openSignaturePopup('${taskId}')">üñäÔ∏è</span>
        <div class="signature-image" style="margin-top:5px;"></div>
      `;

      taskList.appendChild(taskDiv);
      saveTasks(dienst);
    }

    function saveTasks(dienst) {
      const taskList = document.getElementById(`${dienst}-${currentDay}`);
      const tasks = [];
      for (let child of taskList.children) {
        tasks.push({ id: child.id });
      }
      localStorage.setItem(`tasks-${dienst}-${currentDay}`, JSON.stringify(tasks));
    }

    function loadTasks(dienst) {
      const taskList = document.getElementById(`${dienst}-${currentDay}`);
      taskList.innerHTML = '';
      const saved = localStorage.getItem(`tasks-${dienst}-${currentDay}`);
      if (saved) {
        const tasks = JSON.parse(saved);
        tasks.forEach((task, index) => {
          const taskDiv = document.createElement('div');
          taskDiv.className = 'task';
          taskDiv.id = task.id;
          taskDiv.innerHTML = `
            Aufgabe ${index + 1}
            <span class="sign-icon" title="Unterschreiben" onclick="openSignaturePopup('${task.id}')">üñäÔ∏è</span>
            <div class="signature-image" style="margin-top:5px;"></div>
          `;
          taskList.appendChild(taskDiv);
          loadSignature(task.id);
        });
      }
    }

    function prevDay() {
      currentDay = Math.max(1, currentDay - 1);
      updateView();
    }

    function nextDay() {
      const maxDay = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
      currentDay = Math.min(maxDay, currentDay + 1);
      updateView();
    }

    function toggleAdminMode() {
      updateView();
    }

    function openSignaturePopup(taskId) {
      currentTaskId = taskId;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('signaturePopup').style.display = 'block';
    }

    function closeSignaturePopup() {
      document.getElementById('signaturePopup').style.display = 'none';
      currentTaskId = null;
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawingTouch);
    canvas.addEventListener('touchmove', drawTouch);
    canvas.addEventListener('touchend', stopDrawing);

    function startDrawing(e) {
      isDrawing = true;
      lastX = e.offsetX;
      lastY = e.offsetY;
    }
    function draw(e) {
      if (!isDrawing) return;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      lastX = e.offsetX;
      lastY = e.offsetY;
    }
    function stopDrawing() {
      isDrawing = false;
    }

    function getTouchPos(touchEvent) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: touchEvent.touches[0].clientX - rect.left,
        y: touchEvent.touches[0].clientY - rect.top
      };
    }
    function startDrawingTouch(e) {
      e.preventDefault();
      isDrawing = true;
      const pos = getTouchPos(e);
      lastX = pos.x;
      lastY = pos.y;
    }
    function drawTouch(e) {
      e.preventDefault();
      if (!isDrawing) return;
      const pos = getTouchPos(e);
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      lastX = pos.x;
      lastY = pos.y;
    }

    function saveSignature() {
      if (!currentTaskId) return;
      const dataURL = canvas.toDataURL();
      localStorage.setItem('signature_' + currentTaskId, dataURL);
      loadSignature(currentTaskId);
      closeSignaturePopup();
    }

    function loadSignature(taskId) {
      const dataURL = localStorage.getItem('signature_' + taskId);
      if (dataURL) {
        const taskDiv = document.getElementById(taskId);
        if (taskDiv) {
          let imgDiv = taskDiv.querySelector('.signature-image');
          if (!imgDiv) {
            imgDiv = document.createElement('div');
            imgDiv.className = 'signature-image';
            taskDiv.appendChild(imgDiv);
          }
          imgDiv.innerHTML = `<img src="${dataURL}" alt="Unterschrift" style="max-width:100%; max-height:80px; border:1px solid #ccc;">`;
        }
      }
    }

    updateView();
  </script></body>
</html>
