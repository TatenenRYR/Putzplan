<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Putzplan</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background-color: #f0fdf4;
    }
    header {
      background-color: #4ade80;
      padding: 10px;
      text-align: center;
      font-size: 1.5rem;
      color: white;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: #bbf7d0;
    }
    .book-view {
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 20px;
    }
    .day-section {
      background: white;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .task-list {
      margin-top: 10px;
    }
    .task {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #ecfdf5;
    }
    .sign-icon {
      cursor: pointer;
      margin-left: 10px;
    }
    .signature-image img {
      max-width: 100%;
      max-height: 80px;
      border: 1px solid #ccc;
    }
    .signature-popup {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #666;
      padding: 10px;
      z-index: 1000;
    }
    .signature-canvas {
      width: 100%;
      height: 150px;
      border: 1px solid black;
    }
    .admin-only {
      display: none;
    }
    .admin-mode .admin-only {
      display: inline-block;
    }
    .admin-toggle {
      background: #4ade80;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .date-display {
      text-align: center;
      font-size: 1.2rem;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <header>Putzplan</header>
  <div class="navigation">
    <button onclick="prevDay()">‚óÄ</button>
    <div class="date-display" id="dateDisplay"></div>
    <button onclick="nextDay()">‚ñ∂</button>
  </div>
  <div class="navigation">
    <button class="admin-toggle" onclick="toggleAdmin()">Administration</button>
  </div>
  <div class="book-view">
    <div class="day-section">
      <h3>Fr√ºhdienst</h3>
      <div id="frueh" class="task-list"></div>
      <button class="admin-only" onclick="addTask('frueh')">+ Aufgabe hinzuf√ºgen</button>
    </div>
    <div class="day-section">
      <h3>Sp√§tdienst</h3>
      <div id="spaet" class="task-list"></div>
      <button class="admin-only" onclick="addTask('spaet')">+ Aufgabe hinzuf√ºgen</button>
    </div>
  </div>  <div id="signaturePopup" class="signature-popup" style="display:none;">
    <canvas id="signatureCanvas" class="signature-canvas"></canvas>
    <br>
    <button onclick="saveSignature()">Speichern</button>
    <button onclick="closeSignaturePopup()">Abbrechen</button>
  </div>  <script>
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let currentTaskId = null;
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    let currentDate = new Date();

    function updateDateDisplay() {
      document.getElementById('dateDisplay').innerText = currentDate.toLocaleDateString();
      loadTasks();
    }

    function prevDay() {
      currentDate.setDate(currentDate.getDate() - 1);
      updateDateDisplay();
    }

    function nextDay() {
      currentDate.setDate(currentDate.getDate() + 1);
      updateDateDisplay();
    }

    function toggleAdmin() {
      document.body.classList.toggle('admin-mode');
    }

    function addTask(section) {
      const id = `${section}_${currentDate.toDateString()}_${Date.now()}`;
      const taskList = document.getElementById(section);
      const div = document.createElement('div');
      div.className = 'task';
      div.id = id;
      div.innerHTML = `
        <span contenteditable="true">Neue Aufgabe</span>
        <span class="sign-icon" onclick="openSignaturePopup('${id}')">üñäÔ∏è</span>
        <div class="signature-image"></div>
      `;
      taskList.appendChild(div);
      saveTasks();
    }

    function openSignaturePopup(id) {
      currentTaskId = id;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('signaturePopup').style.display = 'block';
    }

    function closeSignaturePopup() {
      document.getElementById('signaturePopup').style.display = 'none';
    }

    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      lastX = e.offsetX;
      lastY = e.offsetY;
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDrawing) return;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      lastX = e.offsetX;
      lastY = e.offsetY;
    });

    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    function saveSignature() {
      const dataURL = canvas.toDataURL();
      localStorage.setItem('sig_' + currentTaskId, dataURL);
      const imgDiv = document.querySelector('#' + currentTaskId + ' .signature-image');
      imgDiv.innerHTML = `<img src="${dataURL}" alt="Unterschrift">`;
      closeSignaturePopup();
    }

    function saveTasks() {
      ['frueh', 'spaet'].forEach(section => {
        const tasks = Array.from(document.getElementById(section).children).map(div => div.innerHTML);
        localStorage.setItem(`${section}_${currentDate.toDateString()}`, JSON.stringify(tasks));
      });
    }

    function loadTasks() {
      ['frueh', 'spaet'].forEach(section => {
        const taskList = document.getElementById(section);
        taskList.innerHTML = '';
        const saved = localStorage.getItem(`${section}_${currentDate.toDateString()}`);
        if (saved) {
          const tasks = JSON.parse(saved);
          tasks.forEach((html, index) => {
            const div = document.createElement('div');
            div.className = 'task';
            div.id = `${section}_${currentDate.toDateString()}_${index}`;
            div.innerHTML = html;
            taskList.appendChild(div);
          });
        }
      });
    }

    window.addEventListener('beforeunload', saveTasks);
    window.addEventListener('DOMContentLoaded', () => {
      updateDateDisplay();
    });
  </script></body>
</html>
