<style>
  /* Bestehendes Design bleibt erhalten, nur leichte Anpassungen f√ºr vertikale Anzeige */

  #dayContainer {
    max-width: 800px;
    margin: auto;
    background-color: #e8f5e9; /* sanftes Gr√ºn */
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  .shift-section {
    background: #c8e6c9; /* leicht dunkleres Gr√ºn */
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 6px;
  }

  .shift-section h3 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #2e7d32;
  }

  .task {
    background: white;
    border: 1px solid #a5d6a7;
    border-radius: 4px;
    padding: 8px 12px;
    margin-bottom: 10px;
    position: relative;
  }

  .task input[type="text"] {
    width: 80%;
    border: none;
    background: transparent;
    font-size: 16px;
    color: #1b5e20;
  }

  .task .sign-icon {
    position: absolute;
    right: 10px;
    top: 10px;
    cursor: pointer;
  }

  .task-list {
    max-height: 250px;
    overflow-y: auto;
  }

  button.add-task-btn {
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    margin-top: 5px;
  }

  button.add-task-btn:hover {
    background-color: #388e3c;
  }
</style>

<div id="dayContainer">
  <div class="shift-section" id="frueh">
    <h3>Fr√ºhdienst</h3>
    <div class="task-list" id="frueh-tasks"></div>
    <button class="add-task-btn" onclick="addTask('frueh-tasks')">+ Aufgabe hinzuf√ºgen</button>
  </div>

  <div class="shift-section" id="tag">
    <h3>Tagdienst</h3>
    <div class="task-list" id="tag-tasks"></div>
    <button class="add-task-btn" onclick="addTask('tag-tasks')">+ Aufgabe hinzuf√ºgen</button>
  </div>

  <div class="shift-section" id="spaet">
    <h3>Sp√§tdienst</h3>
    <div class="task-list" id="spaet-tasks"></div>
    <button class="add-task-btn" onclick="addTask('spaet-tasks')">+ Aufgabe hinzuf√ºgen</button>
  </div>
</div>

<div id="signaturePopup" class="signature-popup" style="display:none;">
  <canvas id="signatureCanvas" class="signature-canvas" width="300" height="150"></canvas>
  <br>
  <button onclick="saveSignature()">Speichern</button>
  <button onclick="closeSignaturePopup()">Abbrechen</button>
</div>

<script>
  let currentTaskId = null;
  let isDrawing = false;
  let lastX = 0;
  let lastY = 0;
  const canvas = document.getElementById('signatureCanvas');
  const ctx = canvas.getContext('2d');

  // Funktion um Aufgabe hinzuzuf√ºgen in jeweilige Schicht-Liste
  function addTask(taskListId) {
    const taskList = document.getElementById(taskListId);
    const taskId = 'task-' + Date.now();

    const taskDiv = document.createElement('div');
    taskDiv.classList.add('task');
    taskDiv.id = taskId;

    // Inputfeld f√ºr Aufgabenname, der sp√§ter gespeichert wird
    taskDiv.innerHTML = `
      <input type="text" placeholder="Aufgabe eingeben" oninput="saveTaskText('${taskId}', this.value)" />
      <span class="sign-icon" title="Unterschreiben" onclick="openSignaturePopup('${taskId}')">üñäÔ∏è</span>
      <div class="signature-image" style="margin-top:5px;"></div>
    `;

    taskList.appendChild(taskDiv);
    loadTaskText(taskId);
    loadSignature(taskId);
  }

  // Aufgabe-Text speichern
  function saveTaskText(taskId, text) {
    localStorage.setItem('tasktext_' + taskId, text);
  }

  // Aufgabe-Text laden
  function loadTaskText(taskId) {
    const taskDiv = document.getElementById(taskId);
    if (!taskDiv) return;
    const input = taskDiv.querySelector('input[type=text]');
    if (!input) return;
    const savedText = localStorage.getItem('tasktext_' + taskId);
    if (savedText) input.value = savedText;
  }

  // √ñffnet das Unterschriftsfenster
  function openSignaturePopup(taskId) {
    currentTaskId = taskId;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById('signaturePopup').style.display = 'block';
  }

  function closeSignaturePopup() {
    document.getElementById('signaturePopup').style.display = 'none';
    currentTaskId = null;
  }

  // Zeichnen im Canvas (Mouse)
  canvas.addEventListener('mousedown', (e) => {
    isDrawing = true;
    lastX = e.offsetX;
    lastY = e.offsetY;
  });

  canvas.addEventListener('mousemove', (e) => {
    if (!isDrawing) return;
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    lastX = e.offsetX;
    lastY = e.offsetY;
  });

  canvas.addEventListener('mouseup', () => {
    isDrawing = false;
  });

  canvas.addEventListener('mouseout', () => {
    isDrawing = false;
  });

  // Zeichnen im Canvas (Touch)
  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    isDrawing = true;
    const rect = canvas.getBoundingClientRect();
    lastX = e.touches[0].clientX - rect.left;
    lastY = e.touches[0].clientY - rect.top;
  }, { passive: false });

  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!isDrawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left;
    const y = e.touches[0].clientY - rect.top;
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    lastX = x;
    lastY = y;
  }, { passive: false });

  canvas.addEventListener('touchend', () => {
    isDrawing = false;
  });

  // Signatur speichern
  function saveSignature() {
    if (!currentTaskId) return;
    const dataURL = canvas.toDataURL();
    localStorage.setItem('signature_' + currentTaskId, dataURL);
    loadSignature(currentTaskId);
    closeSignaturePopup();
  }

  // Signatur laden
  function loadSignature(taskId) {
    const dataURL = localStorage.getItem('signature_' + taskId);
    if (dataURL) {
      const taskDiv = document.getElementById(taskId);
      if (!taskDiv) return;
      let imgDiv = taskDiv.querySelector('.signature-image');
      if (!imgDiv) {
        imgDiv = document.createElement('div');
        imgDiv.className = 'signature-image';
        taskDiv.appendChild(imgDiv);
      }
      imgDiv.innerHTML = `<img src="${dataURL}" alt="Unterschrift" style="max-width:100%; max-height:80px; border:1px solid #ccc;">`;
    }
  }
</script>
