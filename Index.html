<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Putzplan App</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background-color: #f0f0f0; }
    h1, h2 { text-align: center; }
    .date-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .date-display { font-weight: bold; }
    .section { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    ul { list-style: none; padding: 0; }
    li { padding: 0.5rem; border-bottom: 1px solid #ddd; }
    .sign { font-style: italic; color: #999; margin-left: 1rem; white-space: nowrap; cursor: pointer; }
    .btn { display: block; margin: 1rem auto; padding: 0.5rem 1rem; font-size: 1rem; background-color: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .nav-btn { background-color: #007bff; color: white; padding: 0.5rem 1rem; border: none; border-radius: 5px; cursor: pointer; }
    .admin-link { text-align: center; margin-top: 1rem; }
    .admin-link a { color: #007bff; text-decoration: underline; cursor: pointer; }
    #adminModal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 1rem; border-radius: 10px; width: 90%; max-width: 600px; }
    .modal-content textarea { width: 100%; height: 60px; margin-bottom: 0.5rem; }
    .day-switch { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Putzplan - Schnitzelwelt Neuenhaus</h1>
  <div class="date-nav">
    <button class="nav-btn" onclick="changeDay(-1)">&lt; vorheriger Tag</button>
    <div class="date-display" id="currentDate"></div>
    <button class="nav-btn" onclick="changeDay(1)">nächster Tag &gt;</button>
  </div>  <div class="section">
    <h2>Frühschicht</h2>
    <ul id="frueh"></ul>
  </div>  <div class="section">
    <h2>Tagschicht</h2>
    <ul id="tag"></ul>
  </div>  <div class="section">
    <h2>Spätschicht</h2>
    <ul id="spaet"></ul>
  </div><button class="btn" id="submitBtn" onclick="submitPlan()">Plan abschicken</button>

  <div class="admin-link">
    <a onclick="openAdmin()">Administrator: Aufgaben bearbeiten</a>
  </div>  <div id="adminModal">
    <div class="modal-content">
      <div class="day-switch">
        <button class="nav-btn" onclick="switchAdminDay(-1)">&lt;</button>
        <span id="adminDayDisplay">Tag 1</span>
        <button class="nav-btn" onclick="switchAdminDay(1)">&gt;</button>
      </div>
      <p><strong>Frühschicht</strong></p>
      <textarea id="fruehEdit"></textarea>
      <p><strong>Tagschicht</strong></p>
      <textarea id="tagEdit"></textarea>
      <p><strong>Spätschicht</strong></p>
      <textarea id="spaetEdit"></textarea>
      <button class="btn" onclick="saveAdmin()">Speichern</button>
      <button class="btn" style="background:#999" onclick="closeAdmin()">Abbrechen</button>
    </div>
  </div>  <script>
    let offset = 0;
    let adminDay = 1;
    let adminPlan = JSON.parse(localStorage.getItem("putzplan_admin_tasks") || 'null');
    if (!adminPlan) {
      adminPlan = {};
      for (let i = 1; i <= 31; i++) {
        adminPlan[i] = {
          frueh: ["Fritteusen filtern/Fett wechseln (nach Fettliste)", "To Do Liste abarbeiten (vom Vortag)", "Ware wegräumen (alt vor neu!)"],
          tag: ["Nachmittagsliste abarbeiten", "Temperaturliste ausfüllen (15:00–17:00 Uhr)", "Außer Haus Station reinigen, Wasser tauschen", "Bain Marie Burger & Hauptstation reinigen, Wasser tauschen", "Alle Wandfliesen und weiße Mauer reinigen"],
          spaet: ["Saucen / Bainmarie: Wasser ablassen, reinigen, entkalken", "Schneidbretter abräumen, abkochen", "Auffülllisten schreiben für nächsten Tag", "Unter der Bratplatte reinigen", "Unter der Schnitzelfritteuse reinigen", "Küche schrubben, abziehen, Bodenabläufe reinigen", "Papiertonne rausstellen"]
        };
      }
      localStorage.setItem("putzplan_admin_tasks", JSON.stringify(adminPlan));
    }

    function formatDate(d) { return d.toLocaleDateString('de-DE'); }
    function getCurrentDateKey() {
      const d = new Date(); d.setDate(d.getDate() + offset);
      return formatDate(d);
    }

    function getDayNumber() {
      const d = new Date(); d.setDate(d.getDate() + offset);
      return d.getDate();
    }

    function renderPlan() {
      const dateKey = getCurrentDateKey();
      const history = JSON.parse(localStorage.getItem("putzplan_history") || '{}');
      const saved = history[dateKey] || {};
      const isFinal = Object.keys(saved).length > 0;
      const day = getDayNumber();
      const plan = adminPlan[day] || { frueh: [], tag: [], spaet: [] };

      document.getElementById('currentDate').textContent = dateKey;

      ['frueh','tag','spaet'].forEach(section => {
        const ul = document.getElementById(section); ul.innerHTML = '';
        plan[section].forEach(aufgabe => {
          const li = document.createElement('li');
          if (isFinal) {
            const signer = saved[aufgabe] || '(nicht unterschrieben)';
            li.textContent = `${aufgabe}: ${signer}`;
          } else {
            li.innerHTML = `${aufgabe}<span class="sign" data-task="${aufgabe}" onclick="enterSignature(this)">Unterschreiben</span>`;
            if (saved[aufgabe]) {
              li.querySelector('.sign').textContent = saved[aufgabe];
              li.querySelector('.sign').classList.add('filled');
              li.querySelector('.sign').setAttribute('data-signed', saved[aufgabe]);
            }
          }
          ul.appendChild(li);
        });
      });
      document.getElementById('submitBtn').style.display = isFinal ? 'none' : 'block';
    }

    function enterSignature(el) {
      const name = prompt("Bitte deinen Namen eingeben zum Unterschreiben:");
      if (!name) return;
      el.textContent = name;
      el.classList.add('filled');
      el.setAttribute('data-signed', name);
    }

    function submitPlan() {
      const date = getCurrentDateKey();
      const result = {};
      document.querySelectorAll('.sign.filled').forEach(el => {
        const task = el.getAttribute('data-task');
        result[task] = el.getAttribute('data-signed') || el.textContent;
      });
      const history = JSON.parse(localStorage.getItem("putzplan_history") || '{}');
      history[date] = result;
      localStorage.setItem("putzplan_history", JSON.stringify(history));
      alert('Plan gespeichert.'); renderPlan();
    }

    function changeDay(n) { offset += n; renderPlan(); }

    function openAdmin() {
      document.getElementById('adminModal').style.display = 'flex';
      renderAdminDay();
    }

    function closeAdmin() { document.getElementById('adminModal').style.display = 'none'; }

    function switchAdminDay(n) {
      adminDay += n;
      if (adminDay < 1) adminDay = 31;
      if (adminDay > 31) adminDay = 1;
      renderAdminDay();
    }

    function renderAdminDay() {
      const p = adminPlan[adminDay] || { frueh: [], tag: [], spaet: [] };
      document.getElementById('adminDayDisplay').textContent = 'Tag ' + adminDay;
      document.getElementById('fruehEdit').value = p.frueh.join('\n');
      document.getElementById('tagEdit').value = p.tag.join('\n');
      document.getElementById('spaetEdit').value = p.spaet.join('\n');
    }

    function saveAdmin() {
      adminPlan[adminDay] = {
        frueh: document.getElementById('fruehEdit').value.split('\n').map(t=>t.trim()).filter(Boolean),
        tag: document.getElementById('tagEdit').value.split('\n').map(t=>t.trim()).filter(Boolean),
        spaet: document.getElementById('spaetEdit').value.split('\n').map(t=>t.trim()).filter(Boolean)
      };
      localStorage.setItem("putzplan_admin_tasks", JSON.stringify(adminPlan));
      renderAdminDay();
    }

    renderPlan();
  </script></body>
</html>
