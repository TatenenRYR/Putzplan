<style>
  body {
    font-family: sans-serif;
    background-color: #e6f4ea;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
  }
  .book-view {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    background: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    padding: 20px;
    border-radius: 20px;
    margin-top: 20px;
  }
  .day-column {
    padding: 15px;
    border-right: 2px solid #ccc;
  }
  .day-column:last-child {
    border-right: none;
  }
  .task {
    margin-bottom: 10px;
    padding: 8px;
    border: 1px solid #ccc;
    position: relative;
    background: #f6fff9;
    border-radius: 5px;
  }
  .task textarea {
    width: 100%;
    resize: none;
  }
  .sign-icon {
    position: absolute;
    right: 5px;
    top: 5px;
    cursor: pointer;
  }
  .signature-canvas {
    border: 1px solid #000;
    touch-action: none;
  }
  .signature-popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 1px solid #666;
    padding: 10px;
    z-index: 1000;
  }
  .signature-popup button {
    margin-top: 5px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
  }
  .header button {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
  }
  .admin-toggle {
    margin-top: 20px;
    text-align: right;
  }
  .admin-toggle button {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
  }
</style><div class="container">
  <div class="header">
    <button onclick="prevDay()">‚óÄ</button>
    <h2 id="dateDisplay">Datum</h2>
    <button onclick="nextDay()">‚ñ∂</button>
  </div>  <div class="admin-toggle">
    <button onclick="toggleAdmin()" id="adminBtn">Administration aktivieren</button>
  </div>  <div class="book-view">
    <div class="day-column">
      <h3>Fr√ºhdienst</h3>
      <div id="frueh"></div>
      <div id="fruehControls"></div>
    </div>
    <div class="day-column">
      <h3>Sp√§tdienst</h3>
      <div id="spaet"></div>
      <div id="spaetControls"></div>
    </div>
  </div>
</div><div id="signaturePopup" class="signature-popup" style="display:none;">
  <canvas id="signatureCanvas" class="signature-canvas" width="300" height="150"></canvas>
  <br>
  <button onclick="saveSignature()">Speichern</button>
  <button onclick="closeSignaturePopup()">Abbrechen</button>
</div><script>
  let currentDayIndex = new Date().getDate() - 1;
  let adminMode = false;
  const canvas = document.getElementById('signatureCanvas');
  const ctx = canvas.getContext('2d');
  let isDrawing = false;
  let lastX = 0;
  let lastY = 0;
  let currentTaskId = null;

  function updateDateDisplay() {
    const today = new Date();
    const displayDate = new Date(today.getFullYear(), today.getMonth(), currentDayIndex + 1);
    document.getElementById('dateDisplay').innerText = displayDate.toLocaleDateString();
  }

  function renderTasks() {
    ['frueh', 'spaet'].forEach(type => {
      const container = document.getElementById(type);
      const controls = document.getElementById(type + 'Controls');
      container.innerHTML = '';
      controls.innerHTML = '';
      const key = `${type}_day_${currentDayIndex}`;
      const tasks = JSON.parse(localStorage.getItem(key) || '[]');

      tasks.forEach((task, index) => {
        const div = document.createElement('div');
        div.className = 'task';
        div.id = `${key}_task_${index}`;

        if (adminMode) {
          div.innerHTML = `<textarea onchange="saveTask('${key}', ${index}, this.value)">${task}</textarea>`;} else {
      div.innerHTML = `${task}`;
    }

    const signatureImgDiv = document.createElement('div');
    signatureImgDiv.className = 'signature-image';
    signatureImgDiv.innerHTML = loadSignature(div.id);

    div.innerHTML += `<span class="sign-icon" onclick="openSignaturePopup('${div.id}')">üñäÔ∏è</span>`;
    div.appendChild(signatureImgDiv);
    container.appendChild(div);
  });

  if (adminMode) {
    const btn = document.createElement('button');
    btn.textContent = '+ Aufgabe hinzuf√ºgen';
    btn.onclick = () => addTask(type);
    controls.appendChild(btn);
  }
});

}

function saveTask(key, index, value) { const tasks = JSON.parse(localStorage.getItem(key) || '[]'); tasks[index] = value; localStorage.setItem(key, JSON.stringify(tasks)); }

function addTask(type) { const key = ${type}_day_${currentDayIndex}; const tasks = JSON.parse(localStorage.getItem(key) || '[]'); tasks.push(''); localStorage.setItem(key, JSON.stringify(tasks)); renderTasks(); }

function toggleAdmin() { adminMode = !adminMode; document.getElementById('adminBtn').innerText = adminMode ? 'Administration deaktivieren' : 'Administration aktivieren'; renderTasks(); }

function prevDay() { currentDayIndex = (currentDayIndex - 1 + 31) % 31; updateDateDisplay(); renderTasks(); }

function nextDay() { currentDayIndex = (currentDayIndex + 1) % 31; updateDateDisplay(); renderTasks(); }

function openSignaturePopup(taskId) { currentTaskId = taskId; ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById('signaturePopup').style.display = 'block'; }

function closeSignaturePopup() { document.getElementById('signaturePopup').style.display = 'none'; currentTaskId = null; }

canvas.addEventListener('mousedown', e => { isDrawing = true; [lastX, lastY] = [e.offsetX, e.offsetY]; }); canvas.addEventListener('mousemove', e => { if (!isDrawing) return; ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke(); [lastX, lastY] = [e.offsetX, e.offsetY]; }); canvas.addEventListener('mouseup', () => isDrawing = false); canvas.addEventListener('mouseout', () => isDrawing = false);

function saveSignature() { if (!currentTaskId) return; const dataURL = canvas.toDataURL(); localStorage.setItem('signature_' + currentTaskId, dataURL); renderTasks(); closeSignaturePopup(); }

function loadSignature(taskId) { const dataURL = localStorage.getItem('signature_' + taskId); return dataURL ? <img src="${dataURL}" alt="Unterschrift" style="max-width:100%; max-height:80px; border:1px solid #ccc;"> : ''; }

updateDateDisplay(); renderTasks(); </script>

